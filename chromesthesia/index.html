<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Chromesthesia - Text to Watercolor</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@300;400;600&family=Inter:wght@300;400;500&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(180deg, #f8f6f1 0%, #ebe8df 100%);
            min-height: 100vh;
            color: #2c2c2c;
            padding: 2rem 1rem;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 3rem;
        }

        h1 {
            font-family: 'Cormorant Garamond', serif;
            font-size: 4rem;
            font-weight: 300;
            color: #1a1a1a;
            margin-bottom: 0.5rem;
            letter-spacing: 1px;
        }

        .subtitle {
            font-size: 1.1rem;
            color: #666;
            font-weight: 300;
        }

        nav {
            margin-bottom: 2rem;
        }

        nav a {
            color: #666;
            text-decoration: none;
            font-size: 0.95rem;
            transition: color 0.3s;
        }

        nav a:hover {
            color: #1a1a1a;
        }

        .main-grid {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .input-section {
            background: white;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 2px 20px rgba(0, 0, 0, 0.08);
        }

        .section-title {
            font-family: 'Cormorant Garamond', serif;
            font-size: 1.8rem;
            margin-bottom: 1rem;
            color: #1a1a1a;
        }

        textarea {
            width: 100%;
            min-height: 200px;
            padding: 1rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-family: 'Cormorant Garamond', serif;
            font-size: 1.1rem;
            line-height: 1.8;
            resize: vertical;
            transition: border-color 0.3s;
        }

        textarea:focus {
            outline: none;
            border-color: #8b7355;
        }

        .examples {
            margin-top: 1.5rem;
        }

        .example-label {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 0.5rem;
        }

        .example-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .example-btn {
            padding: 0.5rem 1rem;
            background: #f5f5f5;
            border: 1px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.3s;
        }

        .example-btn:hover {
            background: #8b7355;
            color: white;
            border-color: #8b7355;
        }

        .paint-btn {
            width: 100%;
            padding: 1rem;
            margin-top: 1rem;
            background: #8b7355;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 1.1rem;
            font-weight: 500;
            cursor: pointer;
            transition: background 0.3s;
        }

        .paint-btn:hover {
            background: #6d5940;
        }

        .paint-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .canvas-section {
            background: white;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 2px 20px rgba(0, 0, 0, 0.08);
        }

        .canvas-wrapper {
            width: 100%;
            overflow: hidden;
            border: 1px solid #ddd;
            border-radius: 4px;
            background: #fdfcfb;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.05);
        }

        #watercolorCanvas {
            display: block;
            width: 100%;
            height: auto;
        }

        .analysis-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-top: 2rem;
        }

        .analysis-box {
            background: white;
            padding: 1.5rem;
            border-radius: 8px;
            box-shadow: 0 2px 20px rgba(0, 0, 0, 0.08);
        }

        .analysis-title {
            font-family: 'Cormorant Garamond', serif;
            font-size: 1.3rem;
            margin-bottom: 1rem;
            color: #1a1a1a;
        }

        .color-palette {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .color-swatch {
            width: 60px;
            height: 60px;
            border-radius: 4px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
            position: relative;
            cursor: pointer;
        }

        .color-swatch::after {
            content: attr(data-emotion);
            position: absolute;
            bottom: -25px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.7rem;
            color: #666;
            white-space: nowrap;
        }

        .themes-list {
            list-style: none;
        }

        .theme-item {
            padding: 0.5rem 0;
            border-bottom: 1px solid #f0f0f0;
            font-size: 0.95rem;
            color: #555;
        }

        .theme-item:last-child {
            border-bottom: none;
        }

        .theme-icon {
            margin-right: 0.5rem;
        }

        .controls {
            margin-top: 1rem;
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .control-btn {
            padding: 0.5rem 1rem;
            background: white;
            border: 1px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s;
        }

        .control-btn:hover {
            background: #f5f5f5;
            border-color: #8b7355;
        }

        .status-message {
            margin-top: 1rem;
            padding: 1rem;
            background: #f9f9f9;
            border-left: 3px solid #8b7355;
            border-radius: 4px;
            font-size: 0.9rem;
            color: #666;
            display: none;
        }

        .status-message.active {
            display: block;
        }

        footer {
            text-align: center;
            margin-top: 3rem;
            color: #999;
            font-size: 0.9rem;
        }

        @media (max-width: 1024px) {
            .main-grid {
                grid-template-columns: 1fr;
            }

            .analysis-section {
                grid-template-columns: 1fr;
            }

            h1 {
                font-size: 3rem;
            }
        }

        @media (max-width: 640px) {
            h1 {
                font-size: 2.5rem;
            }

            .input-section,
            .canvas-section,
            .analysis-box {
                padding: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <nav>
            <a href="/">‚Üê Back to Projects</a>
        </nav>

        <header>
            <h1>Chromesthesia</h1>
            <p class="subtitle">Transform words into watercolor art ‚Äî visualizing the soul of text</p>
        </header>

        <div class="main-grid">
            <div class="input-section">
                <h2 class="section-title">Your Text</h2>
                <textarea id="textInput" placeholder="Paste a passage, quote, or poem here...

Or try one of the famous examples below."></textarea>

                <div class="examples">
                    <div class="example-label">Try a famous speech:</div>
                    <div class="example-buttons">
                        <button class="example-btn" data-example="mlk">MLK - I Have a Dream</button>
                        <button class="example-btn" data-example="jfk">JFK - Inaugural</button>
                        <button class="example-btn" data-example="angelou">Maya Angelou</button>
                        <button class="example-btn" data-example="dylan">Dylan Thomas</button>
                        <button class="example-btn" data-example="dickens">Dickens</button>
                    </div>
                </div>

                <button class="paint-btn" id="paintBtn">Paint My Words</button>

                <div class="status-message" id="statusMessage"></div>
            </div>

            <div class="canvas-section">
                <h2 class="section-title">Watercolor Vision</h2>
                <div class="canvas-wrapper">
                    <canvas id="watercolorCanvas" width="1200" height="800"></canvas>
                </div>
                <div class="controls">
                    <button class="control-btn" id="downloadBtn">Download Painting</button>
                    <button class="control-btn" id="clearBtn">Clear Canvas</button>
                </div>
            </div>
        </div>

        <div class="analysis-section">
            <div class="analysis-box">
                <h3 class="analysis-title">Emotional Palette</h3>
                <div class="color-palette" id="colorPalette"></div>
            </div>

            <div class="analysis-box">
                <h3 class="analysis-title">Detected Themes</h3>
                <ul class="themes-list" id="themesList"></ul>
            </div>
        </div>

        <footer>
            <p>A synesthetic journey from language to light</p>
        </footer>
    </div>

    <script>
        // Famous speeches database
        const FAMOUS_SPEECHES = {
            mlk: `I have a dream that one day this nation will rise up and live out the true meaning of its creed: We hold these truths to be self-evident, that all men are created equal. I have a dream that my four little children will one day live in a nation where they will not be judged by the color of their skin but by the content of their character. I have a dream today!`,

            jfk: `And so, my fellow Americans: ask not what your country can do for you ‚Äî ask what you can do for your country. My fellow citizens of the world: ask not what America will do for you, but what together we can do for the freedom of man.`,

            angelou: `You may write me down in history with your bitter, twisted lies. You may trod me in the very dirt, but still, like dust, I'll rise. Does my sassiness upset you? Why are you beset with gloom? Just like moons and like suns, with the certainty of tides, just like hopes springing high, still I'll rise.`,

            dylan: `Do not go gentle into that good night. Old age should burn and rave at close of day. Rage, rage against the dying of the light. Though wise men at their end know dark is right, because their words had forked no lightning they do not go gentle into that good night.`,

            dickens: `It was the best of times, it was the worst of times, it was the age of wisdom, it was the age of foolishness, it was the epoch of belief, it was the epoch of incredulity, it was the season of Light, it was the season of Darkness, it was the spring of hope, it was the winter of despair.`
        };

        // Emotion to color mapping
        const EMOTION_COLORS = {
            joy: ['#FFD700', '#FFA500', '#FFB6C1', '#F0E68C'],
            love: ['#FF6B6B', '#FF8E8E', '#FFB3B3', '#E74C3C'],
            sadness: ['#4A90E2', '#5DADE2', '#7B8D93', '#34495E'],
            anger: ['#DC143C', '#CD5C5C', '#8B4513', '#A52A2A'],
            fear: ['#8E44AD', '#9B59B6', '#4A4A4A', '#556B2F'],
            calm: ['#90EE90', '#87CEEB', '#B0C4DE', '#E6E6FA'],
            hope: ['#FFFACD', '#FFD700', '#F0E68C', '#FAFAD2'],
            neutral: ['#D2B48C', '#C0C0C0', '#DEB887', '#F5DEB3']
        };

        // Word-emotion dictionary
        const EMOTION_WORDS = {
            joy: ['joy', 'happy', 'delight', 'cheerful', 'glad', 'merry', 'jolly', 'pleased', 'content', 'bright', 'sunshine', 'laugh', 'smile', 'celebration', 'wonderful', 'fantastic', 'great', 'beautiful', 'lovely', 'amazing'],
            love: ['love', 'beloved', 'cherish', 'adore', 'affection', 'tender', 'caring', 'heart', 'embrace', 'kiss', 'passion', 'romance', 'devotion', 'dear', 'sweetheart', 'warmth'],
            sadness: ['sad', 'sorrow', 'grief', 'melancholy', 'blue', 'tears', 'cry', 'weep', 'mourn', 'lonely', 'alone', 'lost', 'despair', 'misery', 'pain', 'hurt', 'suffering', 'anguish', 'gloom', 'depression'],
            anger: ['anger', 'rage', 'fury', 'mad', 'furious', 'outrage', 'wrath', 'hostile', 'bitter', 'hate', 'resentment', 'annoyed', 'frustrated', 'indignant', 'violent'],
            fear: ['fear', 'afraid', 'scared', 'terror', 'dread', 'anxiety', 'worry', 'nervous', 'panic', 'frightened', 'alarmed', 'horrified', 'threatened', 'danger', 'peril'],
            calm: ['calm', 'peace', 'peaceful', 'serene', 'tranquil', 'quiet', 'still', 'gentle', 'soft', 'soothe', 'relax', 'rest', 'comfort', 'ease', 'harmony', 'balance'],
            hope: ['hope', 'dream', 'aspire', 'wish', 'optimism', 'faith', 'believe', 'trust', 'confidence', 'future', 'tomorrow', 'possibility', 'potential', 'promise', 'inspire', 'inspiration', 'rise', 'rising', 'soar', 'ascend'],
            neutral: ['the', 'and', 'or', 'but', 'with', 'from', 'about', 'which', 'this', 'that', 'have', 'will', 'would', 'could', 'should']
        };

        // Theme to imagery mapping
        const THEME_IMAGERY = {
            freedom: { keywords: ['freedom', 'liberty', 'free', 'liberate', 'release', 'soar', 'fly', 'wings', 'bird', 'sky', 'break', 'chains', 'independent'], icon: 'üïäÔ∏è', paint: 'birds' },
            love: { keywords: ['love', 'romance', 'heart', 'embrace', 'kiss', 'affection', 'beloved', 'cherish', 'adore'], icon: '‚ù§Ô∏è', paint: 'flowers' },
            nature: { keywords: ['nature', 'tree', 'forest', 'mountain', 'river', 'ocean', 'sea', 'flower', 'garden', 'landscape', 'earth', 'green', 'meadow'], icon: 'üåø', paint: 'landscape' },
            struggle: { keywords: ['struggle', 'fight', 'battle', 'conflict', 'war', 'storm', 'wave', 'difficult', 'challenge', 'obstacle', 'adversity'], icon: '‚ö°', paint: 'storm' },
            hope: { keywords: ['hope', 'dream', 'wish', 'aspire', 'faith', 'believe', 'future', 'tomorrow', 'rise', 'rising', 'dawn', 'sunrise', 'light'], icon: '‚ú®', paint: 'sunrise' },
            loss: { keywords: ['loss', 'grief', 'mourn', 'death', 'dying', 'gone', 'lost', 'farewell', 'goodbye', 'end', 'ending', 'autumn', 'fade', 'twilight'], icon: 'üçÇ', paint: 'autumn' },
            strength: { keywords: ['strong', 'strength', 'power', 'mighty', 'courage', 'brave', 'bold', 'fierce', 'lion', 'mountain', 'rock', 'steel', 'iron'], icon: 'üí™', paint: 'mountain' },
            journey: { keywords: ['journey', 'path', 'road', 'way', 'travel', 'voyage', 'quest', 'adventure', 'grow', 'growth', 'change', 'transform', 'evolve'], icon: 'üõ§Ô∏è', paint: 'path' }
        };

        // Canvas setup - FIXED SIZE, no dynamic resizing
        const canvas = document.getElementById('watercolorCanvas');
        const ctx = canvas.getContext('2d');
        
        // Set fixed canvas dimensions (already set in HTML, but confirm here)
        const CANVAS_WIDTH = 1200;
        const CANVAS_HEIGHT = 800;
        
        // Draw initial background
        function drawBackground() {
            ctx.fillStyle = '#fdfcfb';
            ctx.fillRect(0, 0, CANVAS_WIDTH, CANVAS_HEIGHT);
        }
        
        drawBackground();

        // Text analysis
        function analyzeText(text) {
            const words = text.toLowerCase()
                .replace(/[^\w\s]/g, ' ')
                .split(/\s+/)
                .filter(w => w.length > 2);

            const emotionScores = {};
            const detectedThemes = [];
            const palette = [];

            for (const [emotion, emotionWords] of Object.entries(EMOTION_WORDS)) {
                const score = words.filter(word => emotionWords.includes(word)).length;
                if (score > 0) {
                    emotionScores[emotion] = score;
                }
            }

            const sortedEmotions = Object.entries(emotionScores)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 4);

            if (sortedEmotions.length === 0) {
                palette.push(...EMOTION_COLORS.neutral.slice(0, 3));
            } else {
                sortedEmotions.forEach(([emotion]) => {
                    const colors = EMOTION_COLORS[emotion];
                    palette.push(...colors.slice(0, 2));
                });
            }

            for (const [theme, data] of Object.entries(THEME_IMAGERY)) {
                const matches = words.filter(word =>
                    data.keywords.some(keyword => word.includes(keyword) || keyword.includes(word))
                ).length;

                if (matches > 0) {
                    detectedThemes.push({
                        name: theme.charAt(0).toUpperCase() + theme.slice(1),
                        icon: data.icon,
                        paint: data.paint,
                        score: matches
                    });
                }
            }

            detectedThemes.sort((a, b) => b.score - a.score);

            return {
                emotions: sortedEmotions.map(([emotion]) => emotion),
                palette: [...new Set(palette)].slice(0, 6),
                themes: detectedThemes.slice(0, 5),
                primaryTheme: detectedThemes[0]?.paint || 'abstract'
            };
        }

        // Display analysis results
        function displayAnalysis(analysis) {
            const paletteDiv = document.getElementById('colorPalette');
            paletteDiv.innerHTML = '';
            analysis.palette.forEach((color, index) => {
                const swatch = document.createElement('div');
                swatch.className = 'color-swatch';
                swatch.style.background = color;
                swatch.dataset.emotion = analysis.emotions[Math.floor(index / 2)] || '';
                swatch.title = color;
                paletteDiv.appendChild(swatch);
            });

            const themesList = document.getElementById('themesList');
            themesList.innerHTML = '';
            if (analysis.themes.length === 0) {
                themesList.innerHTML = '<li class="theme-item">No specific themes detected ‚Äî creating abstract composition</li>';
            } else {
                analysis.themes.forEach(theme => {
                    const li = document.createElement('li');
                    li.className = 'theme-item';
                    li.innerHTML = `<span class="theme-icon">${theme.icon}</span> ${theme.name}`;
                    themesList.appendChild(li);
                });
            }
        }

        // Watercolor painting functions
        function drawWatercolorBlob(x, y, radius, color, opacity = 0.3) {
            const gradient = ctx.createRadialGradient(x, y, 0, x, y, radius);
            gradient.addColorStop(0, `${color}${Math.floor(opacity * 255).toString(16).padStart(2, '0')}`);
            gradient.addColorStop(0.5, `${color}${Math.floor(opacity * 0.5 * 255).toString(16).padStart(2, '0')}`);
            gradient.addColorStop(1, `${color}00`);

            ctx.fillStyle = gradient;
            ctx.beginPath();

            const points = 20;
            for (let i = 0; i < points; i++) {
                const angle = (i / points) * Math.PI * 2;
                const randomRadius = radius * (0.7 + Math.random() * 0.6);
                const px = x + Math.cos(angle) * randomRadius;
                const py = y + Math.sin(angle) * randomRadius;

                if (i === 0) {
                    ctx.moveTo(px, py);
                } else {
                    ctx.lineTo(px, py);
                }
            }

            ctx.closePath();
            ctx.fill();
        }

        function paintBirds(colors) {
            const width = CANVAS_WIDTH;
            const height = CANVAS_HEIGHT;

            for (let i = 0; i < 30; i++) {
                const x = Math.random() * width;
                const y = Math.random() * height * 0.6;
                const radius = 80 + Math.random() * 160;
                const color = colors[Math.floor(Math.random() * colors.length)];
                drawWatercolorBlob(x, y, radius, color, 0.15);
            }

            for (let i = 0; i < 8; i++) {
                const x = width * 0.2 + Math.random() * width * 0.6;
                const y = height * 0.3 + Math.random() * height * 0.4;
                const color = colors[Math.floor(Math.random() * Math.min(2, colors.length))];

                ctx.strokeStyle = color + '80';
                ctx.lineWidth = 4 + Math.random() * 4;
                ctx.lineCap = 'round';

                ctx.beginPath();
                ctx.arc(x - 30, y, 16, 0, Math.PI, true);
                ctx.stroke();

                ctx.beginPath();
                ctx.arc(x + 30, y, 16, 0, Math.PI, true);
                ctx.stroke();
            }
        }

        function paintFlowers(colors) {
            const width = CANVAS_WIDTH;
            const height = CANVAS_HEIGHT;

            for (let i = 0; i < 20; i++) {
                const x = Math.random() * width;
                const y = Math.random() * height;
                const radius = 120 + Math.random() * 200;
                const color = colors[Math.floor(Math.random() * colors.length)];
                drawWatercolorBlob(x, y, radius, color, 0.2);
            }

            for (let i = 0; i < 12; i++) {
                const x = Math.random() * width;
                const y = height * 0.4 + Math.random() * height * 0.5;
                const color = colors[Math.floor(Math.random() * colors.length)];
                const petalCount = 5 + Math.floor(Math.random() * 3);

                for (let p = 0; p < petalCount; p++) {
                    const angle = (p / petalCount) * Math.PI * 2;
                    const px = x + Math.cos(angle) * 40;
                    const py = y + Math.sin(angle) * 40;
                    drawWatercolorBlob(px, py, 30, color, 0.4);
                }

                drawWatercolorBlob(x, y, 16, colors[0], 0.6);
            }
        }

        function paintLandscape(colors) {
            const width = CANVAS_WIDTH;
            const height = CANVAS_HEIGHT;

            for (let i = 0; i < 25; i++) {
                const x = Math.random() * width;
                const y = Math.random() * height * 0.5;
                const radius = 100 + Math.random() * 200;
                const color = colors[colors.length - 1] || colors[0];
                drawWatercolorBlob(x, y, radius, color, 0.2);
            }

            for (let layer = 0; layer < 3; layer++) {
                const y = height * (0.4 + layer * 0.15);
                const color = colors[Math.floor(layer * colors.length / 3)] || colors[0];

                for (let i = 0; i < 15; i++) {
                    const x = (i / 15) * width;
                    const radius = 80 + Math.random() * 120;
                    drawWatercolorBlob(x, y + Math.random() * 40, radius, color, 0.25 + layer * 0.1);
                }
            }
        }

        function paintStorm(colors) {
            const width = CANVAS_WIDTH;
            const height = CANVAS_HEIGHT;

            for (let i = 0; i < 30; i++) {
                const x = Math.random() * width;
                const y = Math.random() * height * 0.6;
                const radius = 120 + Math.random() * 200;
                const color = colors[Math.floor(Math.random() * colors.length)];
                drawWatercolorBlob(x, y, radius, color, 0.25);
            }

            for (let i = 0; i < 20; i++) {
                const x = Math.random() * width;
                const y = height * 0.6 + Math.random() * height * 0.4;
                const color = colors[Math.floor(Math.random() * colors.length)];
                drawWatercolorBlob(x, y, 80 + Math.random() * 120, color, 0.3);
            }
        }

        function paintSunrise(colors) {
            const width = CANVAS_WIDTH;
            const height = CANVAS_HEIGHT;

            const sunY = height * 0.4;
            for (let i = 0; i < 15; i++) {
                const radius = 80 + i * 20;
                const color = colors[Math.min(i % colors.length, colors.length - 1)];
                drawWatercolorBlob(width / 2, sunY, radius, color, 0.15);
            }

            for (let i = 0; i < 40; i++) {
                const x = Math.random() * width;
                const y = Math.random() * height;
                const radius = 100 + Math.random() * 160;
                const color = colors[Math.floor(Math.random() * colors.length)];
                drawWatercolorBlob(x, y, radius, color, 0.1);
            }
        }

        function paintAutumn(colors) {
            const width = CANVAS_WIDTH;
            const height = CANVAS_HEIGHT;

            for (let i = 0; i < 25; i++) {
                const x = Math.random() * width;
                const y = Math.random() * height;
                const radius = 120 + Math.random() * 200;
                const color = colors[Math.floor(Math.random() * colors.length)];
                drawWatercolorBlob(x, y, radius, color, 0.15);
            }

            for (let i = 0; i < 20; i++) {
                const x = Math.random() * width;
                const y = Math.random() * height;
                const color = colors[Math.floor(Math.random() * colors.length)];

                ctx.fillStyle = color + '60';
                ctx.beginPath();
                ctx.ellipse(x, y, 16, 30, Math.random() * Math.PI, 0, Math.PI * 2);
                ctx.fill();
            }
        }

        function paintMountain(colors) {
            const width = CANVAS_WIDTH;
            const height = CANVAS_HEIGHT;

            for (let i = 0; i < 20; i++) {
                const x = Math.random() * width;
                const y = Math.random() * height * 0.4;
                const radius = 140 + Math.random() * 200;
                const color = colors[colors.length - 1] || colors[0];
                drawWatercolorBlob(x, y, radius, color, 0.15);
            }

            const peakX = width / 2;
            const peakY = height * 0.3;

            for (let i = 0; i < 30; i++) {
                const spread = i * 30;
                const x = peakX + (Math.random() - 0.5) * spread;
                const y = peakY + i * 16;
                const color = colors[Math.floor(i * colors.length / 30)] || colors[0];
                drawWatercolorBlob(x, y, 80 + Math.random() * 80, color, 0.25);
            }
        }

        function paintPath(colors) {
            const width = CANVAS_WIDTH;
            const height = CANVAS_HEIGHT;

            for (let i = 0; i < 30; i++) {
                const x = Math.random() * width;
                const y = Math.random() * height;
                const radius = 120 + Math.random() * 200;
                const color = colors[Math.floor(Math.random() * colors.length)];
                drawWatercolorBlob(x, y, radius, color, 0.15);
            }

            const points = 20;
            for (let i = 0; i < points; i++) {
                const t = i / points;
                const x = width * 0.2 + Math.sin(t * Math.PI * 2) * width * 0.2 + t * width * 0.6;
                const y = height * 0.8 - t * height * 0.5;
                const color = colors[0];
                drawWatercolorBlob(x, y, 50 + Math.random() * 40, color, 0.2);
            }
        }

        function paintAbstract(colors) {
            const width = CANVAS_WIDTH;
            const height = CANVAS_HEIGHT;

            for (let i = 0; i < 50; i++) {
                const x = Math.random() * width;
                const y = Math.random() * height;
                const radius = 80 + Math.random() * 240;
                const color = colors[Math.floor(Math.random() * colors.length)];
                drawWatercolorBlob(x, y, radius, color, 0.2);
            }
        }

        // Main painting function
        async function createPainting(analysis) {
            const { palette, primaryTheme } = analysis;

            // Clear and redraw background
            drawBackground();

            showStatus('Painting in progress...');

            await new Promise(resolve => setTimeout(resolve, 300));

            switch(primaryTheme) {
                case 'birds': paintBirds(palette); break;
                case 'flowers': paintFlowers(palette); break;
                case 'landscape': paintLandscape(palette); break;
                case 'storm': paintStorm(palette); break;
                case 'sunrise': paintSunrise(palette); break;
                case 'autumn': paintAutumn(palette); break;
                case 'mountain': paintMountain(palette); break;
                case 'path': paintPath(palette); break;
                default: paintAbstract(palette);
            }

            showStatus('Painting complete!');
            setTimeout(() => hideStatus(), 2000);
        }

        // UI Functions
        function showStatus(message) {
            const statusDiv = document.getElementById('statusMessage');
            statusDiv.textContent = message;
            statusDiv.classList.add('active');
        }

        function hideStatus() {
            const statusDiv = document.getElementById('statusMessage');
            statusDiv.classList.remove('active');
        }

        // Event Listeners
        document.getElementById('paintBtn').addEventListener('click', async () => {
            const text = document.getElementById('textInput').value.trim();

            if (!text) {
                showStatus('Please enter some text first.');
                setTimeout(() => hideStatus(), 2000);
                return;
            }

            const analysis = analyzeText(text);
            displayAnalysis(analysis);
            await createPainting(analysis);
        });

        document.getElementById('clearBtn').addEventListener('click', () => {
            drawBackground();
            document.getElementById('colorPalette').innerHTML = '';
            document.getElementById('themesList').innerHTML = '';
        });

        document.getElementById('downloadBtn').addEventListener('click', () => {
            const link = document.createElement('a');
            link.download = 'chromesthesia-painting.png';
            link.href = canvas.toDataURL();
            link.click();
        });

        document.querySelectorAll('.example-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const example = btn.dataset.example;
                document.getElementById('textInput').value = FAMOUS_SPEECHES[example];
            });
        });
    </script>
</body>
</html>
